<div class="app-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content" [class.dashboard]="isDashboard()">
      <div class="header-left">
        <button class="app-title" (click)="navigateToDashboard()" type="button">NG20</button>
        @if (showMaster() || showInventory() || showUtility() || showReport() || searchTerm) {
          <button class="menu-btn" (click)="toggleSidenav()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
            </svg>
          </button>
        }
      </div>
      <div class="header-actions">
        <div class="user-profile-container">
          <span class="user-name" (click)="showProfileModal()">{{ authService.currentUser()?.name || 'User' }}</span>
          @if (showProfile()) {
            <div class="profile-dropdown">
              <div class="profile-modal" (click)="$event.stopPropagation()">
                <div class="profile-header">
                  <div class="profile-avatar-large">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                  </div>
                  <div class="profile-title">
                    <h3>{{ authService.currentUser()?.name || 'User Profile' }}</h3>
                    <p>{{ authService.currentUser()?.role || 'Guest' }}</p>
                  </div>
                  <button class="close-btn" (click)="closeProfile()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                  </button>
                </div>
                <div class="profile-content">
                  <div class="profile-section">
                    <div class="profile-grid">
                      <div class="profile-item">
                        <div class="profile-icon">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2Z"/>
                          </svg>
                        </div>
                        <div class="profile-details">
                          <label>Full Name</label>
                          <span>{{ authService.currentUser()?.name || 'Not Available' }}</span>
                        </div>
                      </div>
                      <div class="profile-item">
                        <div class="profile-icon">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4Z"/>
                          </svg>
                        </div>
                        <div class="profile-details">
                          <label>Email Address</label>
                          <span>{{ authService.currentUser()?.email || 'Not Available' }}</span>
                        </div>
                      </div>
                      <div class="profile-item">
                        <div class="profile-icon">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2Z"/>
                          </svg>
                        </div>
                        <div class="profile-details">
                          <label>Username</label>
                          <span>{{ authService.currentUser()?.username || 'Not Available' }}</span>
                        </div>
                      </div>
                      <div class="profile-item">
                        <div class="profile-icon">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                          </svg>
                        </div>
                        <div class="profile-details">
                          <label>Role</label>
                          <span class="role-badge">{{ authService.currentUser()?.role || 'Guest' }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
        <button class="action-btn" (click)="logout()">
          Sign Off
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17 7L15.59 5.59L13 8.17V2H11V8.17L8.41 5.59L7 7L12 12L17 7ZM19 15V18H5V15H3V18C3 19.1 3.9 20 5 20H19C20.1 20 21 19.1 21 18V15H19Z"/>
          </svg>
        </button>
      </div>
    </div>
  </header> 

  <div class="main-layout" [class.dashboard]="isDashboard()">
    <!-- Sidenav -->
    <nav class="sidenav" [class.open]="isSidenavOpen()">
      <div class="sidenav-content">
        <div class="search-box">
          <input type="text" placeholder="Search..." class="search-input" [(ngModel)]="searchTerm">
        </div>
        <ul class="nav-list">
          @if (searchTerm) {
            @for (item of filteredNavItems; track item.name) {
              <li><a href="#" class="nav-link" (click)="item.action(); $event.preventDefault()">{{ item.name }}</a></li>
            }
            @if (filteredNavItems.length === 0) {
              <li><span class="nav-link">No results found</span></li>
            }
          } @else if (showMaster()) {
            <li><a href="#" class="nav-link" (click)="showUserManagementPage(); $event.preventDefault()">User Management</a></li>
            <li><a href="#" class="nav-link" (click)="showRolePermissionsPage(); $event.preventDefault()">Role Permissions</a></li>
            <li><a href="#" class="nav-link" (click)="showCompanyPage(); $event.preventDefault()">Company</a></li>
            <li><a href="#" class="nav-link" (click)="showCategoryPage(); $event.preventDefault()">Category</a></li>
            <li><a href="#" class="nav-link" (click)="showEncryptionPage(); $event.preventDefault()">Encryption</a></li>
          } @else if (showInventory()) {
            <li><a href="#" class="nav-link" (click)="showItemsPage(); $event.preventDefault()">Items</a></li>
            <li><a href="#" class="nav-link" (click)="showStockPage(); $event.preventDefault()">Stock</a></li>

            <li><a href="#" class="nav-link" (click)="showSuppliersPage(); $event.preventDefault()">Suppliers</a></li>
            <li><a href="#" class="nav-link" (click)="showPurchaseOrderPage(); $event.preventDefault()">Purchase Order</a></li>
          } @else if (showUtility()) {
            <li><a href="#" class="nav-link" (click)="showBackupPage(); $event.preventDefault()">Backup</a></li>
            <li><a href="#" class="nav-link" (click)="showRestorePage(); $event.preventDefault()">Restore</a></li>
            <li><a href="#" class="nav-link" (click)="showSettingsPage(); $event.preventDefault()">Settings</a></li>
            <li><a href="#" class="nav-link" (click)="showLogsPage(); $event.preventDefault()">Logs</a></li>
            <li><a href="#" class="nav-link" (click)="showMaintenancePage(); $event.preventDefault()">Maintenance</a></li>
          } @else if (showReport()) {
            <li><a href="#" class="nav-link" (click)="showSalesReportPage(); $event.preventDefault()">Sales Report</a></li>
            <li><a href="#" class="nav-link" (click)="showInventoryReportPage(); $event.preventDefault()">Inventory Report</a></li>
            <li><a href="#" class="nav-link" (click)="showUserActivityReportPage(); $event.preventDefault()">User Activity Report</a></li>
            <li><a href="#" class="nav-link" (click)="showFinancialReportPage(); $event.preventDefault()">Financial Report</a></li>
          } @else {
            @if (hasMenuAccess('Master')) {
              <li><a href="#" class="nav-link" (click)="showMasterMenu(); $event.preventDefault()">Master</a></li>
            }
            @if (hasMenuAccess('Inventory')) {
              <li><a href="#" class="nav-link" (click)="showInventoryMenu(); $event.preventDefault()">Inventory</a></li>
            }
            @if (hasMenuAccess('Utility')) {
              <li><a href="#" class="nav-link" (click)="showUtilityMenu(); $event.preventDefault()">Utility</a></li>
            }
            @if (hasMenuAccess('Reports')) {
              <li><a href="#" class="nav-link" (click)="showReportMenu(); $event.preventDefault()">Report</a></li>
            }
          }
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" [class.shifted]="isSidenavOpen()" [class.dashboard]="isDashboard()">
      <div class="content">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>

@if (showProfile()) {
  <div class="backdrop" (click)="closeProfile()"></div>
}